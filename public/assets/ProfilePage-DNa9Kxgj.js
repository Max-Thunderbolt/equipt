import{_ as se,f as le,g as te,r as u,h as k,i as oe,d as ie,c as l,u as x,t as n,a as e,b as ne,w as P,v as C,F as D,j as ce,k as B,l as re,s as q,p as de,e as ue,o as t,n as ve}from"./index-BzJ7YkvY.js";import{u as _e,F as pe}from"./FilesGrid-DK2Ef0U4.js";const M=m=>(de("data-v-d8c39225"),m=m(),ue(),m),he={class:"profile-page"},fe={key:0,class:"loading"},be={key:1,class:"error"},me={key:2,class:"profile-container"},ye={class:"profile-section"},ge={class:"profile-header"},ke={class:"avatar-container"},Pe=["src"],Ce={key:1,class:"avatar placeholder"},je={key:2,class:"avatar-upload"},we={class:"profile-info"},Fe={class:"email"},Se={key:1,class:"edit-form"},xe={class:"form-actions"},De=["disabled"],Me={class:"bio-section"},Ue={key:0,class:"bio-display"},Ee={key:0,class:"bio-text"},Ve={key:1,class:"bio-placeholder"},$e={class:"bio-actions"},Le={class:"char-count"},Ne={class:"projects-section"},Ie={class:"project-category"},Be=M(()=>e("h3",null,"Solo Projects",-1)),qe={class:"carousel-container"},Ge=["disabled"],Te={class:"projects-grid"},ze=["onClick"],Ae={class:"project-description"},Re={class:"project-meta"},We={class:"date"},Ye=["disabled"],He={class:"project-category"},Je=M(()=>e("h3",null,"Group Projects",-1)),Ke={class:"carousel-container"},Oe=["disabled"],Qe={class:"projects-grid"},Xe=["onClick"],Ze={class:"project-description"},ea={class:"project-meta"},aa={class:"date"},sa=["disabled"],la={class:"files-section"},ta=M(()=>e("h3",null,"My Files",-1)),oa={key:0,class:"loading"},ia={key:1,class:"error"},na={key:2},_=3,ca={__name:"ProfilePage",setup(m){const{user:v}=ie(),{loading:G,error:U,fetchProfile:T,updateProfile:z}=le(),{fetchUserProjects:A}=te(),{updateMissingFileUrls:R}=_e(),i=u(null),j=u([]),f=u(!1),y=u(!1),r=u({display_name:"",email:"",avatar_url:"",bio:""}),p=u(0),h=u(0),w=k(()=>j.value.filter(a=>!a.collaborators||a.collaborators.length===0)),F=k(()=>j.value.filter(a=>a.collaborators&&a.collaborators.length>0)),W=k(()=>{const a=p.value*_;return w.value.slice(a,a+_)}),Y=k(()=>{const a=h.value*_;return F.value.slice(a,a+_)}),H=()=>{p.value<Math.ceil(w.value.length/_)-1&&p.value++},J=()=>{p.value>0&&p.value--},K=()=>{h.value<Math.ceil(F.value.length/_)-1&&h.value++},O=()=>{h.value>0&&h.value--},Q=()=>{var a,o,d,c;r.value={display_name:((a=i.value)==null?void 0:a.display_name)||"",email:((o=i.value)==null?void 0:o.email)||"",avatar_url:((d=i.value)==null?void 0:d.avatar_url)||"",bio:((c=i.value)==null?void 0:c.bio)||""},f.value=!0},X=()=>{var a,o,d,c;r.value={display_name:((a=i.value)==null?void 0:a.display_name)||"",email:((o=i.value)==null?void 0:o.email)||"",avatar_url:((d=i.value)==null?void 0:d.avatar_url)||"",bio:((c=i.value)==null?void 0:c.bio)||""},f.value=!1},E=async()=>{if(v.value){y.value=!0;try{const a=await z(v.value.id,r.value);a&&(i.value=a,f.value=!1)}catch(a){console.error("Failed to update profile:",a)}finally{y.value=!1}}},V=a=>new Date(a).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),b=u([]),S=u(!1),g=u(null),Z=async()=>{if(v.value){S.value=!0,g.value=null;try{const{data:a,error:o}=await q.from("project_files").select("*").eq("uploaded_by",v.value.id).order("created_at",{ascending:!1});if(o)throw o;b.value=a||[];const d=b.value.filter(c=>!c.url&&c.file_path);if(d.length>0){await R(d);const{data:c}=await q.from("project_files").select("*").eq("uploaded_by",v.value.id).order("created_at",{ascending:!1});c&&(b.value=c)}}catch(a){console.error("Error fetching user files:",a),g.value="Failed to load files"}finally{S.value=!1}}},ee=a=>{b.value=b.value.filter(o=>o.id!==a.id)};return oe(async()=>{if(v.value){i.value=await T(v.value.id);const a=await A(v.value.id);a&&(j.value=a),await Z()}}),(a,o)=>{var d,c,$,L,N,I;return t(),l("div",he,[x(G)?(t(),l("div",fe," Loading profile... ")):x(U)?(t(),l("div",be,n(x(U)),1)):(t(),l("div",me,[e("div",ye,[e("div",ge,[e("div",ke,[(d=i.value)!=null&&d.avatar_url?(t(),l("img",{key:0,src:i.value.avatar_url,alt:"Profile",class:"avatar"},null,8,Pe)):(t(),l("div",Ce,n((($=(c=i.value)==null?void 0:c.display_name)==null?void 0:$[0])||"?"),1)),f.value?(t(),l("div",je,[P(e("input",{type:"url","onUpdate:modelValue":o[0]||(o[0]=s=>r.value.avatar_url=s),placeholder:"Enter avatar URL",class:"avatar-url-input"},null,512),[[C,r.value.avatar_url]])])):ne("",!0)]),e("div",we,[f.value?(t(),l("div",Se,[P(e("input",{"onUpdate:modelValue":o[1]||(o[1]=s=>r.value.display_name=s),type:"text",placeholder:"Display Name",class:"edit-input"},null,512),[[C,r.value.display_name]]),P(e("input",{"onUpdate:modelValue":o[2]||(o[2]=s=>r.value.email=s),type:"email",placeholder:"Email",class:"edit-input",disabled:""},null,512),[[C,r.value.email]]),e("div",xe,[e("button",{onClick:X,class:"cancel-button"},"Cancel"),e("button",{onClick:E,class:"save-button",disabled:y.value},n(y.value?"Saving...":"Save Changes"),9,De)])])):(t(),l(D,{key:0},[e("h2",null,n((L=i.value)==null?void 0:L.display_name),1),e("p",Fe,n((N=i.value)==null?void 0:N.email),1),e("button",{onClick:Q,class:"edit-button"},"Edit Profile")],64))])]),e("div",Me,[f.value?(t(),l("form",{key:1,class:"bio-form",onSubmit:ce(E,["prevent"])},[P(e("textarea",{"onUpdate:modelValue":o[3]||(o[3]=s=>r.value.bio=s),placeholder:"Write something about yourself...",class:"bio-input",maxlength:"500"},null,512),[[C,r.value.bio]]),e("div",$e,[e("span",Le,n(500-r.value.bio.length)+" characters remaining",1)])],32)):(t(),l("div",Ue,[(I=i.value)!=null&&I.bio?(t(),l("p",Ee,n(i.value.bio),1)):(t(),l("p",Ve,"No bio yet"))]))])]),e("div",Ne,[e("div",Ie,[Be,e("div",qe,[e("button",{onClick:J,class:"carousel-button prev",disabled:p.value===0},"←",8,Ge),e("div",Te,[(t(!0),l(D,null,B(W.value,s=>(t(),l("div",{key:s.id,class:"project-card",onClick:ae=>a.$router.push(`/projects/${s.id}`)},[e("h4",null,n(s.name),1),e("p",Ae,n(s.description),1),e("div",Re,[e("span",We,n(V(s.created_at)),1)])],8,ze))),128))]),e("button",{onClick:H,class:"carousel-button next",disabled:p.value>=Math.ceil(w.value.length/_)-1},"→",8,Ye)])]),e("div",He,[Je,e("div",Ke,[e("button",{onClick:O,class:"carousel-button prev",disabled:h.value===0},"←",8,Oe),e("div",Qe,[(t(!0),l(D,null,B(Y.value,s=>(t(),l("div",{key:s.id,class:"project-card",onClick:ae=>a.$router.push(`/projects/${s.id}`)},[e("h4",null,n(s.name),1),e("p",Ze,n(s.description),1),e("div",ea,[e("span",{class:ve(["role-badge",s.role])},n(s.role),3),e("span",aa,n(V(s.created_at)),1)])],8,Xe))),128))]),e("button",{onClick:K,class:"carousel-button next",disabled:h.value>=Math.ceil(F.value.length/_)-1},"→",8,sa)])])]),e("div",la,[ta,S.value?(t(),l("div",oa," Loading files... ")):g.value?(t(),l("div",ia,n(g.value),1)):(t(),l("div",na,[re(pe,{files:b.value,layout:"grid",allowDelete:!0,emptyMessage:"You haven't uploaded any files yet",onDelete:ee},null,8,["files"])]))])]))])}}},ua=se(ca,[["__scopeId","data-v-d8c39225"]]);export{ua as default};
