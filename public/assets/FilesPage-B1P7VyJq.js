import{_ as N,r as c,h as V,d as J,i as R,c as o,a as t,b as j,w as E,v as x,n as w,C as B,l as U,t as g,s as D,p as A,e as Y,o as i}from"./index-BzJ7YkvY.js";import{u as q,F as G}from"./FilesGrid-DK2Ef0U4.js";const d=m=>(A("data-v-611bbc53"),m=m(),Y(),m),Q={class:"files-page container"},W={class:"page-header"},H=d(()=>t("h1",null,"My Files",-1)),K={class:"controls"},X={class:"search-bar"},Z={class:"view-controls"},ee={class:"sort-controls"},te=d(()=>t("label",{for:"sort-select"},"Sort by:",-1)),se=d(()=>t("option",{value:"newest"},"Newest",-1)),ae=d(()=>t("option",{value:"oldest"},"Oldest",-1)),le=d(()=>t("option",{value:"name"},"Name",-1)),oe=d(()=>t("option",{value:"size"},"Size",-1)),ie=[se,ae,le,oe],ne={class:"tabs"},re={class:"content"},ce={key:0,class:"loading-state"},de=d(()=>t("div",{class:"spinner"},null,-1)),ue=d(()=>t("p",null,"Loading files...",-1)),ve=[de,ue],_e={key:1,class:"error-state"},pe={key:2,class:"empty-state"},fe={key:0},he={key:1},we={key:2},me={key:3},ye={key:0,class:"preview-modal"},be={class:"preview-content"},ge={class:"preview-header"},Fe={class:"preview-body"},ke=["src","alt"],je=["src"],Ce={key:2,class:"no-preview"},Se=d(()=>t("p",null,"Preview not available for this file type",-1)),Ee={class:"file-meta"},De={class:"preview-footer"},Me=["href"],Pe={__name:"FilesPage",setup(m){const y={PROJECT_FILES:"project_files",PROJECTS:"projects"},{user:f}=J(),{updateMissingFileUrls:M,deleteFile:P,downloadFile:T}=q(),b=c(!0),u=c(null),v=c([]),L=c({}),n=c("all"),h=c(""),_=c("newest"),p=c("list"),l=c(null),F=c(!1),O=async()=>{if(f.value){b.value=!0,u.value=null;try{const{data:s,error:e}=await D.from(y.PROJECT_FILES).select(`
        *,
        project:${y.PROJECTS}(id, name, owner_id, is_public)
      `).order("created_at",{ascending:!1});if(e)throw e;v.value=s||[];const a=v.value.filter(r=>!r.url&&r.file_path);if(a.length>0){await M(a);const{data:r}=await D.from(y.PROJECT_FILES).select(`
          *,
          project:${y.PROJECTS}(id, name, owner_id, is_public)
        `).order("created_at",{ascending:!1});r&&(v.value=r)}const k={};v.value.forEach(r=>{r.project&&!k[r.project.id]&&(k[r.project.id]=r.project)}),L.value=k}catch(s){console.error("Error fetching files:",s),u.value="Failed to load files"}finally{b.value=!1}}},C=V(()=>{if(!f.value)return[];let s=[...v.value];if(n.value==="owned"?s=s.filter(e=>e.project&&e.project.owner_id===f.value.id):n.value==="shared"&&(s=s.filter(e=>e.project&&e.project.owner_id!==f.value.id)),h.value.trim()){const e=h.value.toLowerCase().trim();s=s.filter(a=>a.name.toLowerCase().includes(e)||a.project&&a.project.name.toLowerCase().includes(e))}return _.value==="newest"?s.sort((e,a)=>new Date(a.created_at)-new Date(e.created_at)):_.value==="oldest"?s.sort((e,a)=>new Date(e.created_at)-new Date(a.created_at)):_.value==="name"?s.sort((e,a)=>e.name.localeCompare(a.name)):_.value==="size"&&s.sort((e,a)=>(a.size_bytes||0)-(e.size_bytes||0)),s}),$=async s=>{try{await P(s.file_path,s.id)?v.value=v.value.filter(a=>a.id!==s.id):u.value="Failed to delete file"}catch(e){console.error("Error deleting file:",e),u.value="Failed to delete file"}},z=s=>{l.value=s,F.value=!0},S=()=>{F.value=!1,l.value=null},I=async s=>{try{if(!s||!s.file_path){u.value="Invalid file information";return}await T(s.file_path)}catch(e){console.error("Error downloading file:",e),u.value="Failed to download the file"}};return R(async()=>{f.value&&await O()}),(s,e)=>(i(),o("div",Q,[t("div",W,[H,t("div",K,[t("div",X,[E(t("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=a=>h.value=a),placeholder:"Search files...",class:"search-input"},null,512),[[x,h.value]])]),t("div",Z,[t("button",{class:w(["view-btn",{active:p.value==="grid"}]),onClick:e[1]||(e[1]=a=>p.value="grid"),title:"Grid View"}," ◫ ",2),t("button",{class:w(["view-btn",{active:p.value==="list"}]),onClick:e[2]||(e[2]=a=>p.value="list"),title:"List View"}," ≡ ",2)]),t("div",ee,[te,E(t("select",{id:"sort-select","onUpdate:modelValue":e[3]||(e[3]=a=>_.value=a),class:"sort-select"},ie,512),[[B,_.value]])])])]),t("div",ne,[t("button",{class:w(["tab-btn",{active:n.value==="all"}]),onClick:e[4]||(e[4]=a=>n.value="all")}," All Files ",2),t("button",{class:w(["tab-btn",{active:n.value==="owned"}]),onClick:e[5]||(e[5]=a=>n.value="owned")}," My Projects ",2),t("button",{class:w(["tab-btn",{active:n.value==="shared"}]),onClick:e[6]||(e[6]=a=>n.value="shared")}," Shared With Me ",2)]),t("div",re,[b.value?(i(),o("div",ce,ve)):u.value?(i(),o("div",_e,g(u.value),1)):C.value.length===0?(i(),o("div",pe,[h.value?(i(),o("p",fe,"No files match your search query.")):n.value==="all"?(i(),o("p",he,"You don't have any files yet.")):n.value==="owned"?(i(),o("p",we,"You don't have any files in your projects.")):(i(),o("p",me,"You don't have any files in shared projects."))])):j("",!0),U(G,{files:C.value,loading:b.value,layout:p.value==="grid"?"standard":"list",viewMode:p.value,allowDelete:!0,emptyMessage:"No files found",onDelete:$,onPreview:z,onDownload:I,class:"files-grid-improved"},null,8,["files","loading","layout","viewMode"])]),F.value&&l.value?(i(),o("div",ye,[t("div",{class:"preview-overlay",onClick:S}),t("div",be,[t("div",ge,[t("h3",null,g(l.value.name),1),t("button",{class:"close-btn",onClick:S},"×")]),t("div",Fe,[l.value.url&&/\.(jpe?g|png|gif|webp)$/i.test(l.value.name)?(i(),o("img",{key:0,src:l.value.url,alt:l.value.name,class:"preview-image"},null,8,ke)):l.value.url&&/\.pdf$/i.test(l.value.name)?(i(),o("iframe",{key:1,src:l.value.url,class:"preview-iframe"},null,8,je)):(i(),o("div",Ce,[Se,t("p",Ee,g(l.value.name)+" ("+g(s.formatFileSize(l.value.size_bytes))+") ",1)]))]),t("div",De,[l.value.url?(i(),o("a",{key:0,href:l.value.url,download:"",class:"download-btn"}," Download ",8,Me)):j("",!0)])])])):j("",!0)]))}},Oe=N(Pe,[["__scopeId","data-v-611bbc53"]]);export{Oe as default};
